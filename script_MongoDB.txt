DOCKER

#Desinstalar paquetes conflictivos:

for pkg in docker.io docker-doc docker-compose docker-compose-v2 podman-
docker containerd runc; do sudo apt-get remove $pkg; done




# Añade la clave GPG oficial de Docker:

sudo apt-get update

sudo apt-get install ca-certificates curl

sudo install -m 0755 -d /etc/apt/keyrings

sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc

sudo chmod a+r /etc/apt/keyrings/docker.asc





# Añadir el repositorio a las fuentes APT:

echo \ "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \

$(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \

sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

sudo apt-get update





#Instalar la última versión:

sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin

docker-compose-plugin





#Verifica que la instalación de Docker Engine es correcta:

sudo docker run hello-world




# Configura Docker para iniciarse en el arranque del sistema:


sudo systemctl enable docker.service

sudo systemctl enable containerd.service






#Container Docker de MongoDB

#Descargar imagen de MongoDB V.4:

sudo docker pull mongo:4



#Ejecutar el contenedor de MongoDB:

sudo docker run --name my-mongo -d -p 27017:27017 mongo:4



#Verificar si el contenedor se está ejecutando:

sudo docker ps




#Abrir shell de MongoDB:

sudo docker exec -it my-mongo mongo




#Ejemplo crear DB y colección

use productos

db.createCollection("ordenadores")




#Insertar datos en la colección:

db.ordenadores.insertOne({

modelo: "Acer Aspire",

tipo: "Portátil",

ram: "16GB"

})






#Verificar inserción de datos:

db.ordenadores.find().pretty()






#Detener el contenedor:

sudo docker stop my-mongo

S.O.: Ubuntu Server 22.04 LTS (Jammy)





Webs:

Ubuntu | Docker Docs

Post-installation steps | Docker Docs

mongo - Official Image | Docker Hub



#Integracio al fitxer python escriptura coses a la BD.


pip install pymongo

sudo docker exec -it my-mongo mongo

use logs

db.createCollection("fitxers_pujats")


# Exemple:

#	db.fitxers_pujats.insertOne({
#	    nom_arxiu: "ejemplo.txt",
#	    ruta: "/uploads/ejemplo.txt",
#	    hash: "abc123hash",
#	    infectat: false,
#	    usuari: "victor",
#	    data_pujada: new Date()
#	})







# Inicar servei
 sudo docker start my-mongo
sudo docker exec -it my-mongo mongo






A revisar 4 de març:

- Permisos???
- Autenticacio amb password???