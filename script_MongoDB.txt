DOCKER

# Desinstal·lar paquets conflictius (no cal fer-ho):

for pkg in docker.io docker-doc docker-compose docker-compose-v2 podman-
docker containerd runc; do sudo apt-get remove $pkg; done



# Afegir la clau GPG oficial de Docker:

sudo apt-get update

sudo apt-get install ca-certificates curl

sudo install -m 0755 -d /etc/apt/keyrings

sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc

sudo chmod a+r /etc/apt/keyrings/docker.asc



# Afegir el repositori a les fonts APT (hem de posar les comandes una per una):

echo \ "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \

$(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \

sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

sudo apt-get update



#Instal·lar l'última versió de Docker:

sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin



#Verificar que la instal·lació de Docker Engine és correcte:

sudo docker run hello-world



# Configurar Docker per iniciar-se en l'arrancada del sistema:

sudo systemctl enable docker.service

sudo systemctl enable containerd.service



# Container Docker de MongoDB:

# Descargar imatge de MongoDB V.4:

sudo docker pull mongo:4



# Executar el contenidor de MongoDB (s'ha de crear abans la ruta local de les dades):

sudo mkdir /mongodb

sudo docker run --name my-mongo -d -p 27017:27017 -v /mongodb:/data/db mongo:4



# Verificar si el contenidor s'està executan:

sudo docker ps



# Obrir la shell de MongoDB:

sudo docker exec -it my-mongo mongo



----------------------------------

# Exemple crear DB i col·lecció

use productos

db.createCollection("ordenadores")


#Insertar dades a la col·lecció:

db.ordenadores.insertOne({

modelo: "Acer Aspire",

tipo: "Portátil",

ram: "16GB"

})


#Verificar la inserció de dades:

db.ordenadores.find()

----------------------------------


#Detenir el contenidor:

sudo docker stop my-mongo





# Integració de MongoDB al codi de Python per poder escriure coses a la BD

sudo pip3 install pymongo

sudo docker exec -it my-mongo mongo

use logs

db.createCollection("fitxers_pujats")


# Exemple:

#	db.fitxers_pujats.insertOne({
#	    nom_arxiu: "ejemplo.txt",
#	    ruta: "/uploads/ejemplo.txt",
#	    hash: "abc123hash",
#	    infectat: false,
#	    usuari: "victor",
#	    data_pujada: new Date()
#	})




# Inicar servei
sudo docker start my-mongo
sudo docker exec -it my-mongo mongo





# php mongo

cd ~

sudo apt update

sudo apt install php-pear php-dev libmongoc-dev libbson-dev

sudo pecl install mongodb

echo "extension=mongodb.so" | sudo tee /etc/php/8.1/mods-available/mongodb.ini

sudo phpenmod mongodb

sudo systemctl restart apache2

php -m | grep mongodb


sudo apt install php-cli unzip

sudo curl -sS https://getcomposer.org/installer | php

sudo mv composer.phar /usr/local/bin/composer

cd /var/www/html

sudo composer require mongodb/mongodb

